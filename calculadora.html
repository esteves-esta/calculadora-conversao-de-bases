<!DOCTYPE html>
<html lang="pt">
<head>

	<meta charset="utf-8">
	<title>Calculadora</title>

	<style type="text/css">
		
		*{
			margin:0px;
			padding: 0px;
			box-sizing: border-box;
			font-family: 'Calibri', sans-serif;
		}

		body{
			display: flex;
			flex-wrap: wrap;
			flex-direction: row;
			justify-content: space-around;
			align-items: center;
			height: 100vh;
		}

		input, select, button{
			width: 200px;
			display: block;
			padding: 8px 5px;
			margin: 15px 0px;
		}

		label{
			display: block;
		}

		article{
			width: 50%;
		}

	</style>
</head>
<body>

	<article>
		
		<h2>Calculadora</h2>

		<form>
			

			<label>Selecione o tipo de conversão: </label>

			<label>De: </label>
			<select id="de">
				<option value="" selected disabled>Tipo de número</option>
				<option value="1">Binário</option>
				<option value="2">Decimal</option>
				<option value="3">Octal</option>
				<option value="4">Hexadecimal</option>
			</select>

			<label>Para: </label>
			<select id="para">
				<option value="" selected disabled>Tipo de converção</option>
				<option value="1">Binário</option>
				<option value="2">Decimal</option>
				<option value="3">Octal</option>
				<option value="4">Hexadecimal</option>
			</select>

			<label>Digite o número a ser convertido</label>
			<input type="text" id="numero">

			<label>Resultado da Conversão:</label>
			<input type="text" id="convertido" disabled placeholder="Conversão">

			<button type="button" onclick="conversaoBases()">Converter</button>

			<button type="reset">Resetar formulário</button>

		</form>

	</article>

</body>
</html>

<script type="text/javascript">
	var converterDe = document.getElementById("de");
	var converterPara = document.getElementById("para");
	var numInserido = document.getElementById("numero");
	var resultado = document.getElementById("convertido");
	

	function conversaoBases(){

		switch(converterDe.value){
			case '1':
			//BINÁRIO

				switch(converterPara.value){
					case '1':
						alert('Não pode converter pro mesmo tipo né');
						break;
					case '2':
						//DECIMAL
						resultado.value = binarioToDecimal(numInserido.value);
						break;
					case '3':
						//OCTAL
						resultado.value = binarioToOctal(numInserido.value);
						break;
					case '4':
						//HEXADECIMAL
						resultado.value = binarioToHexa(numInserido.value);
						break;
				}
			break;
			case '2':
				//DECIMAL
			break;
			case '3':
				//OCTAL
			break;
			case '4':
				//HEXADECIMAL
				switch(converterPara.value){
					case '1':
					//BINÁRIO
					resultado.value = hexaToBinario(numInserido.value);
					break;
					case '2':
					//DECIMAL
					resultado.value = hexaToDecimal(numInserido.value);
					break;
					case '3':
					//OCTAL
					resultado.value = hexaToOctal(numInserido.value);
					break;
				}
			break;
		}

	}

//---------------------------------------------------------------

	//FUNÇÃO QUE TRANFORMA NÚMERO DE BINÁRIO PARA DECIMAL
	// 		a função pega cada caracter do fim ao começo
	// 		e verifica se é o numero 1
	// 		se for verdadeiro ele irá potencializar 2 à posição do caracter 
	// 		que é contada pela variavel posicaoDoCaracter
	// 		e o resultado é armazenar na variável numResultado 
	// 		e somado com o contéudo já presente nesta variável
	//  
	function binarioToDecimal(num){

		// remover espaços em branco da string
		num = num.replace(/ /g,'');

		//variavel onde será armazenado o resultado
		var numResultado = 0;

		//valor para saber em que posição do número está
		//esse valor será aumentando por 1 a cada loop 
		var posicaoDoCaracter = 0;

		//valor do comprimeto do numero/string -1 para começar do primero numero da direita
		//esse valor será diminuido por 1 a cada loop
		var comprimentoAoContrario = num.length - 1;


		//se o numero atual for 1
		//entrar e potenciar 2 pela posição do caracter
		//e armazenar na variavel numResultado
		//e somar com o contéudo desta variável
		for (var i = 0; i < num.length; i++) {

			if(num.charAt(comprimentoAoContrario) === '1'){
				numResultado = numResultado + (2 ** posicaoDoCaracter);
			}

			posicaoDoCaracter++;
			comprimentoAoContrario--;
		}

		return numResultado;
	}




//--------------------------------------------------------------
	//FUNÇÃO QUE TRANSFORMA DE BINÁRIO PARA OCTAL
	//		separar conjuntos de 3 bits, do fim da da string para o começo 
	//		(da direita para  esquerada)
	//		colocar os numeros numa string para exibilos sem virgula
	// 		e colocar os números na ordem correta

	function  binarioToOctal(num){

		// remover todos os espaços em branco da string
		num = num.replace(/ /g,'');

		// comeco e fim para usar na função substring
		var comeco = num.length;
		var fim = num.length - 3;

		//array para guardar cada conjunto de 3 bits
		var arrayResultado = Array();

		for (var i = 0; i < num.length; i++) {
			if(num.substring(comeco, fim) == ''){
				//se não houver mais numeros ele irá sair do looop
				break;
			}

			//passa cada conjunto de 3 bits para a função de binario para decimal
		 	arrayResultado[i] = binarioToDecimal(num.substring(comeco, fim));

		 	//fim e comeco somados com 3 para ir pegando cada tres bits do numero
			fim = fim - 3;
			comeco = comeco - 3;

		}

		//loop para colocar os numeros numa variavel para exibi-los sem as virgulas da array
		var resultadoContrario = arrayResultado.toString().replace(/,/g, '');
		var resultado = '';

		for(var i = resultadoContrario.length-1; i >= 0; i--){
			resultado = resultado + '' + resultadoContrario[i];
		}		

		return resultado;
	}


//---------------------------------------------------------
	// FUNÇÃO PRA CONVERTER DE BINÁRIO PARA HEXADECIMAL
	//		separar conjuntos de 4 bits, do fim da da string para o começo 
	//		(da direita para esquerada)
	// 		e passa-los pela funcao que converte de binario para hexadecimal
	//		e depois converter numeros de 10 a 15 para letra
	// 		e colocar os números na ordem correta
	function binarioToHexa(num){

		// remover espaços em branco da string
		num = num.replace(/ /g,'');

		// comeco e fim para usar na função substring
		var comeco = num.length;
		var fim = num.length - 4;

		// array para guardar cada conjunto de 4 bits
		var arrayResultado = Array();

		for (var i = 0; i < num.length; i++) {
			if(num.substring(comeco, fim) == ''){
				// se não houver mais numeros ele irá sair do looop
				break;
			}

			// passa cada conjunto de 4 bits 
			// para a função de binario para decimal
		 	arrayResultado[i] = binarioToDecimal(num.substring(comeco, fim));

		 	// fim e comeco subtraidos com 4
		 	// para pegar o próximo conjunto de 4 bits
			fim = fim - 4;
			comeco = comeco - 4;
		}

		// loop para colocar os numeros 
		// numa variavel para exibi-los sem as virgulas da array
		// e modificar os números de 10 a 15 para A a F
		var resultado = '';
		var numeroEmOrdem = [];
		var indexContrario = arrayResultado.length-1;

		for(var i = 0; i < arrayResultado.length; i++){
			var numNormal = [10, 11, 12, 13, 14, 15];
			var numLetra = ['A', 'B', 'C', 'D', 'E', 'F'];

			for(var x = 0; x < numNormal.length; x++){
				if(arrayResultado[i] === numNormal[x]){
					// se for igual mudar para o mesmo index na array com letras
					arrayResultado[i] = numLetra[x];
					break;
				}
			}	
				numeroEmOrdem[indexContrario] = arrayResultado[i];
				indexContrario--;
		}

		resultado = numeroEmOrdem.toString().replace(/,/g,'');

		return resultado;
	}


//----------------------------------------------------------------

	// FUNÇÃO QUE CONVERTER DE HEXADECIMAL PARA BINÁRIO
	// 		primeira a função colocar os números separados na array listaDeNumeros
	//		depois tranformam o padrão alfabético em numérico, converte todos os numeros para int
	//		e passa esses números para a função toBinario 
	//		e depois converte esse numero para string e retira as virgulas

	function hexaToBinario(num){

		// remover espaços em branco da string
		num = num.replace(/ /g,'');

		// deixa todos os números em capitular
		num = num.toUpperCase();
		
		//colocar numeros na array
		var listaDeNumeros = Array();
		for(var i = 0; i < num.length; i++){
			listaDeNumeros[i] = num.charAt(i);
		}


		//transformar letras em numeros se houver
		for(var i = 0; i < listaDeNumeros.length; i++){
			var numNormal = [10, 11, 12, 13, 14, 15];
			var numLetra = ['A', 'B', 'C', 'D', 'E', 'F']; 

			for(var x = 0; x < numNormal.length; x++){
				if(listaDeNumeros[i] === numLetra[x]){
					listaDeNumeros[i] = numNormal[x];
					break;
				}
			}	
				if(!isNaN(listaDeNumeros[i])){
					listaDeNumeros[i] = parseInt(listaDeNumeros[i]);
				}
		}

		//passa cada numero individualmente pela funcao decimal para binário
		//e depois verifica se precisa de zeros para completar o conjunto de 4 bits
		var numerosBinarios = Array();
		for (var i = 0; i < listaDeNumeros.length; i++) {
			numerosBinarios[i] = decimalToBinario(listaDeNumeros[i]);
			console.log(numerosBinarios[i]);
			
			if(numerosBinarios[i].length < 4){
				var zerosQfaltam = 4 - numerosBinarios[i].length;
				console.log(numerosBinarios[i].length);

				
				var index = 0;
				var zeros = '';
				while(index < zerosQfaltam){
					console.log(index);
					zeros = zeros + '0';
					index++;
				}

				numerosBinarios[i] = zeros + numerosBinarios[i];
			}

		}
		
		
		//Pega números convertidos para binario e coloca em string
		var numeroCompleto = numerosBinarios.toString().replace(/,/g,'');

		return numeroCompleto;

	}

//-----------------------------------------------------

	// FUNÇÃO QUE TRANSFORMA DECIMAL PARA BINÁRIO
	//		a funcao pega o numero e entra em um loop
	//		onde o numeros será divido e se o resto for igual a 1 guarda 1 e ao contrario guarda 0
	//		depois o número é colocado na ordem correta e retornado como string
	//		
	function decimalToBinario(num){
		
		var numBinarioOrdenado = Array();
		var numeroDividido = 0;
		var indexInterno = 0;
		
		var i = 0; 
		do {
			//declarado aqui para ficar vazio depois
			var numBinario = [];

			numeroDividido = num;

			//é um loop do porque se for só um número ele entra direto no loop sem problema
			do{	
				//continua a dividir um número até ser 0
				if(numeroDividido % 2 === 1){
					numBinario[indexInterno] = 1;	
				}
				else{
					numBinario[indexInterno] = 0;
				}

				//divide o numero e o arredonda
				numeroDividido = Math.floor(numeroDividido / 2);

				//vai para proximo local na array
				indexInterno++;

			} while(numeroDividido > 0);

			
			//coloca o numero da ordem certa
			var indexNormal = numBinarioOrdenado.length;
			var indexContrario = numBinario.length - 1;

			for(var x = 0; x < numBinario.length; x++){
				// se for numero coloca na outra array
				// na orderm correta
				if(!isNaN(numBinario[indexContrario])){
					numBinarioOrdenado[indexNormal] = numBinario[indexContrario];

					indexContrario--;
					indexNormal++;
				}
			}

			//aumenta o index do primero loop do
			i++;

		}while (i < num.length)

		return numBinarioOrdenado.toString().replace(/,/g, '');
	}

</script>